
const RGB_H__n=(_,a,t)=>{const o=Math.max(_,a,t),e=Math.min(_,a,t);if(o===e)return 0;const n=o-e;return~~(60*(o===_?(a-t)/n+(a<t?6:0):o===a?(t-_)/n+2:(_-a)/n+4))},RGB_S__n=(_,a,t)=>{const o=Math.max(_,a,t),e=Math.min(_,a,t),n=o-e;if(!n)return 0;const s=e+o;return s>255?n/(510-n):n/s},RGB_L__n=(_,a,t)=>(Math.min(_,a,t)+Math.max(_,a,t))/510,STAT_W_o={port_o:null,pixel_n:1,status_o:{scan_b:!1},message_a:["GET_scan","GET_status","GET_frequency","GET_img","PUT_canvas","PUT_draw","PUT_hsl","PUT_scale"],scan_a:null,SCAN_hue_n:0,SCAN_hue_freq_n:1,SCAN_hue_rank_n:2,SCAN_sat_n:3,SCAN_sat_freq_n:4,SCAN_sat_rank_n:5,SCAN_lum_n:6,SCAN_lum_freq_n:7,SCAN_lum_rank_n:8,stat_o:{},script_o:new Set,imgBitmap_a:new Map,imgLayer_a:[],script__v(_){if(_){let a=[];for(let t of _.split(" "))STAT_W_o.script_o.has(t)||(STAT_W_o.script_o.add(t),a.push(`${t}.min.js`));a.length&&self.importScripts(...a)}},scale__n(_,a,t){const{width:o,height:e}=STAT_W_o.stat_o[`${_}_o`][`${a}_o`].canvas_o;STAT_W_o.stat_o[`${_}_o`][`${a}_o`].context_o.clearRect(0,0,o,e);const n=.5*o*(1-t);STAT_W_o.stat_o[`${_}_o`][`${a}_o`].context_o.setTransform(t,0,0,t,n,n)},async bitmap__o(_){try{let{rect_s:a,scale_n:t,url_s:o,storeBitmap_b:e}=_;if(STAT_W_o.imgBitmap_a.has(o))return STAT_W_o.imgBitmap_a.get(o);let[n,s,T,c]=a.split(" ");const r=await fetch(o),l=await r.blob(),S=await createImageBitmap(l,n-T/t*.5,s-c/t*.5,T/t,c/t,{resizeWidth:T,resizeHeight:c,resizeQuality:"high"});return e&&STAT_W_o.imgBitmap_a.set(o,S),S}catch(_){return console.log(`ERROR DETECTED @bitmap__o(): ${_}`),null}},get_status__v(){STAT_W_o.post__v({task_s:"PUT_status",status_o:STAT_W_o.status_o},[STAT_W_o.status_o])},async get_scan__v(_){if(!STAT_W_o.scan_a){
//!!!!!!!!!!!!!!!!!!!!!!!!!!
//!!!!!!!!!!!!!!!!!!!!!!!!!!
const a=`/assets/media/img/${_.work_s}/full/max/0/color.jpeg`,t=await fetch(a),o=await t.blob(),e=await createImageBitmap(o),n=new OffscreenCanvas(e.width,e.height).getContext("2d");n.drawImage(e,0,0);const s=n.getImageData(0,0,e.width,e.height);STAT_W_o.capacity_n=e.width*e.height,STAT_W_o.scan_a=new Array(1+STAT_W_o.SCAN_lum_rank_n);let T,c,r,l=360;for(STAT_W_o.scan_a[STAT_W_o.SCAN_hue_n]=new Array(l),STAT_W_o.scan_a[STAT_W_o.SCAN_hue_freq_n]=new Array(l);--l>=0;)STAT_W_o.scan_a[STAT_W_o.SCAN_hue_n][l]=[],STAT_W_o.scan_a[STAT_W_o.SCAN_hue_freq_n][l]=0;for(l=101,STAT_W_o.scan_a[STAT_W_o.SCAN_sat_n]=new Array(l),STAT_W_o.scan_a[STAT_W_o.SCAN_sat_freq_n]=new Array(l);--l>=0;)STAT_W_o.scan_a[STAT_W_o.SCAN_sat_n][l]=[],STAT_W_o.scan_a[STAT_W_o.SCAN_sat_freq_n][l]=0;for(l=101,STAT_W_o.scan_a[STAT_W_o.SCAN_lum_n]=new Array(l),STAT_W_o.scan_a[STAT_W_o.SCAN_lum_freq_n]=new Array(l);--l>=0;)STAT_W_o.scan_a[STAT_W_o.SCAN_lum_n][l]=[],STAT_W_o.scan_a[STAT_W_o.SCAN_lum_freq_n][l]=0;for(let _=0;_<s.data.length;_+=4){T=s.data[_],c=s.data[_+1],r=s.data[_+2];let a=RGB_H__n(T,c,r);STAT_W_o.scan_a[STAT_W_o.SCAN_hue_n][a].push(_),STAT_W_o.scan_a[STAT_W_o.SCAN_hue_freq_n][a]+=1;let t=~~(100*RGB_S__n(T,c,r));STAT_W_o.scan_a[STAT_W_o.SCAN_sat_n][t].push(_),STAT_W_o.scan_a[STAT_W_o.SCAN_sat_freq_n][t]+=1;let o=~~(100*RGB_L__n(T,c,r));STAT_W_o.scan_a[STAT_W_o.SCAN_lum_n][o].push(_),STAT_W_o.scan_a[STAT_W_o.SCAN_lum_freq_n][o]+=1}const S=_=>{const a=_.length;let t=new Array(a);for(let o=0;o<a;++o)t[o]=[_[o],o];return t.sort(((_,a)=>a[0]-_[0])),t};STAT_W_o.scan_a[STAT_W_o.SCAN_hue_rank_n]=S(STAT_W_o.scan_a[STAT_W_o.SCAN_hue_freq_n]),STAT_W_o.scan_a[STAT_W_o.SCAN_sat_rank_n]=S(STAT_W_o.scan_a[STAT_W_o.SCAN_sat_freq_n]),STAT_W_o.scan_a[STAT_W_o.SCAN_lum_rank_n]=S(STAT_W_o.scan_a[STAT_W_o.SCAN_lum_freq_n])}},get_frequency__v(_){const{part_s:a,range_n:t}=_;let o,e=_.angle_n;if(360!==t&&101!==t){let _=360/t;e=~~(e/_);let a=e*_;o=[a,a+_]}else o=[e];STAT_W_o.stat_o.burst_o[`${a}_o`].part_a;const n=STAT_W_o.stat_o.burst_o[`${a}_o`].part_a[e],s=n?n.frequency_n:0;STAT_W_o.post__v({task_s:"PUT_frequency",part_s:a,frequency_n:s,range_a:o,capacity_n:STAT_W_o.capacity_n})},async get_img__v(_){try{const a=await STAT_W_o.bitmap__o(_);if(a){const t=_.canvas_e,o=t.getContext("2d");o.drawImage(a,0,0);const e={canvas_e:_.canvas_e,context_o:o,imgData_o:o.getImageData(0,0,t.width,t.height)};_.layer_n&&(e.layer_n=_.layer_n),STAT_W_o.imgLayer_a.push(e)}}catch(_){console.log(`ERROR DETECTED @get_img__v(): ${_}`)}},put_canvas__v(_){STAT_W_o.pixel_n=_.pixel_n;const{stat_s:a,part_s:t}=_;STAT_W_o.stat_o[`${a}_o`]||(STAT_W_o.stat_o[`${a}_o`]={}),STAT_W_o.stat_o[`${a}_o`][`${t}_o`]={},STAT_W_o.stat_o[`${a}_o`][`${t}_o`].canvas_o=_.canvas_e;const o=_.canvas_e.getContext("2d");STAT_W_o.pixel_n=_.pixel_n,STAT_W_o.stat_o[`${a}_o`][`${t}_o`].context_o=o,STAT_W_o.stat_o[`${a}_o`][`${t}_o`].painter_c=new Painter(o)},put_draw__v(_){let a,{stat_s:t,part_s:o,back_hue_n:e,rangeY_n:n,shift_n:s,maxpos_n:T,thresh_o:c}=_,[r,l]=o.split("_");switch(t){case"burst":let l=0;if("hue"===r)l=360;else l=101;switch(a=STAT_W_o.stat_o[`${t}_o`][`${o}_o`].painter_c,o){case"hue_back":for(let _=0;_<360;++_){let t=_+s%360;a.fill__c([t,100,50]).rect__c(0,2*_,a.context_o.canvas.width,2,"fill")}break;case"hue_front":for(let _=0;_<360;++_){let t=(Math.floor(_/n)*n+s)%360;a.fill__c([t,100,50]).rect__c(0,2*_,a.context_o.canvas.width,2,"fill")}}let S=0,A=0,i=0,W=0,f=0;STAT_W_o.stat_o[`${t}_o`][`${r}_o`].part_a=[];const h=STAT_W_o.scan_a[STAT_W_o[`SCAN_${r}_freq_n`]].slice(0,s),u=STAT_W_o.scan_a[STAT_W_o[`SCAN_${r}_freq_n`]].slice(s).concat(h);for(let _ of u){let a,T,c;switch(o){case"hue":a=(S+s)%360,T=100,c=50;break;case"sat":a=e,T=S,c=50;break;case"lum":a=e,T=0,c=S;break;case"hue_front":if(n>1&&i<=n&&(W+=_,i++,S++,S<360))continue;W>f&&(f=W),W&&(_=W),W=0,i=0,a=(Math.floor(A/n)*n+s)%360,T=100,c=50,A=S}STAT_W_o.stat_o[`${t}_o`][`${r}_o`].part_a.push(_?{frequency_n:_,hsl_a:[a,T,c]}:null),++S}const p=STAT_W_o.stat_o[`${t}_o`][`${r}_o`].canvas_o.width,m={frequency_a:STAT_W_o.stat_o[`${t}_o`][`${r}_o`].part_a,capacity_n:"hue_front"===o?STAT_W_o.stat_o[`${t}_o`][`${r}_o`].part_a.length:l,canvas_o:STAT_W_o.stat_o[`${t}_o`][`${r}_o`].canvas_o,median_n:.5*p,maxfreq_n:f||STAT_W_o.scan_a[STAT_W_o[`SCAN_${r}_rank_n`]][0][0],maxpos_n:p*T,thresh_o:c};STAT_W_o.stat_o[`${t}_o`][`${r}_o`].burst_c=new ColorBurst(m);break;case"paint":switch(a=STAT_W_o.stat_o[`${t}_o`][`${o}_o`].painter_c,r){case"hue":for(let _=0;_<360;++_)a.fill__c([_,100,50]).rect__c(0,2*_,100,2,"fill");break;case"sat":for(let t=0;t<101;++t)a.fill__c([_.hue_n,t,50]).rect__c(0,2*t,100,2,"fill");break;case"lum":for(let _=0;_<101;++_)a.fill__c([0,0,_]).rect__c(0,2*_,100,2,"fill")}}},put_hsl__v(_){
//!!!!!!!!!!!!!!!!!!!!!!!!!!
//!!!!!!!!!!!!!!!!!!!!!!!!!!
let{stat_s:a,operand_a:t,operation_s:o,deviation_n:e,hsl_s:n,rangeX_n:s,atX_n:T,rangeY_n:c,atY_n:r}=_;const l=T/s;let S=~~l;l>1&&++S,S*=s,S>100&&(S=100);let A=~~(2.559*S),i=.01*S+.001;r*=2,c*=2,STAT_W_o.stat_o[`${a}_o`][`${n}_front_o`].painter_c.fill__c([190,28,17,1]).rect__c(S,r,100-S,c,"fill").rect__c(0,r,S,c,"clear").fill__c([0,0,100,1-i]).rect__c(0,r,S,c,"fill");const W=_.atY_n;let f=W+_.rangeY_n;const h="hue"===n?359:100;f>h&&(f=h);const u=STAT_W_o.scan_a[STAT_W_o[`SCAN_${n}_n`]],p=[];for(let _ of t)p.push({layer_o:STAT_W_o.imgLayer_a.find((a=>a.layer_n===+_.layer_n)),clipRect_a:_.clipRect_a});let m,g;o&&"none"!==o&&(m=p[0].layer_o.imgData_o,g=p?.[1]?.layer_o?.imgData_o,p.splice(0,2));for(let _ of p){const a=_.layer_o.context_o,t=_.layer_o.imgData_o,n=t.data;let s,T,c;for(s=W;s<f;++s){let _,a,t;T=u[s],c=T.length;let r=!0;for(atScan_n=0;atScan_n<c;++atScan_n){if(m&&g)switch(_=m[T[atScan_n]+3],a=g[T[atScan_n]+3],t=~~(_-a),o){case"union":r=_&&a;break;case"difference":r=t>e;break;case"intersection":r=t<=e;break;case"complement":r=_&&!a}r&&(n[T[atScan_n]+3]=A)}}const r=_.clipRect_a.length?_.clipRect_a:[[0,0,_.layer_o.canvas_e.width,_.layer_o.canvas_e.height]];for(let _ of r)a.putImageData(t,0,0,..._)}
//!!!!!!!!!!!!!!!!!!!!!!!!!!
//!!!!!!!!!!!!!!!!!!!!!!!!!!
},put_scale__v(_){const{stat_s:a,part_s:t,scale_n:o}=_;STAT_W_o.scale__n(a,t,o),STAT_W_o.stat_o[`${a}_o`][`${t}_o`].burst_c.draw__v()},message__v(_){const a=_.data;STAT_W_o.script__v(a.script_s);const t=a.task_s;if(STAT_W_o.message_a.includes(t)){const _=t.toLowerCase()+"__v";STAT_W_o[_](a)}},post__v(_){STAT_W_o.port_o.postMessage(_)},handleError__v(_){console.log`ERROR: ${_.message}`}};onconnect=_=>{STAT_W_o.port_o=_.ports[0],STAT_W_o.port_o.onmessage=STAT_W_o.message__v,STAT_W_o.port_o.onmessageerror=STAT_W_o.handleError__v};