
const FUL_o={listener__v:()=>{const _=document.getElementById("goto_full_screen");_&&_.addEventListener("click",(()=>document.fullscreenElement&&document.exitFullscreen()||document.querySelector("body")?.requestFullscreen()))}},BUR_o={SCALE_V_n:2,status_o:null,trace_o:null,hueFreeze_b:!1,hue_n:0,hue_o:{rangeY_n:1,shift_n:0},scale_o:{hue_n:1,sat_n:.5,lum_n:.5},thresh_o:{hi_n:100,lo_n:0},message__v(_){switch(_.task_s){case"PUT_frequency":BUR_o.put_frequency__v(_);break;case"PUT_status":BUR_o.status_o=_.status_o;break;case"PUT_error":console.log(`ERROR: ${_.error_s}`)}},put_frequency__v(_){const{part_s:e,frequency_n:t,range_a:o,capacity_n:r}=_;let s=o[0];o.length>1&&(s+=`...${o[1]}`),BUR_o.trace_o[`${e}_e`].innerHTML=s;const n=t/r*100;BUR_o.trace_o[`${e}Ratio_e`].innerHTML=new Intl.NumberFormat("fr-FR").format(Number.parseFloat(n).toFixed(2))},get_frequency__v(_,e){let t="hue"===e?360:101,o=BUR_o.angle__n(_,t);if(360===t){let _=document.querySelector('label:has(input[name="burst_hue_range"]:checked)');_&&(t=360/+_.dataset.range_n)}BUR_o.worker_o.post__v({task_s:"GET_frequency",stat_s:"burst",part_s:e,angle_n:o,range_n:t})},screen__v(){let _=screen.height;for(canvas_s of(DOM_o.rootVar__v("--burst_screen_dim",_),["hue","sat","lum"])){let e=document.getElementById(`CA_burst_${canvas_s}`);e&&(e.width=_,e.height=_)}},hsl__s:()=>document?.querySelector('input[name="burst_nav"]:checked')?.id.slice(-3),coord__a(_,e){console.log(e);const t=.5*document.getElementById(`CA_burst_${e}`).width;return[_.offsetX-t,_.offsetY-t]},angle__n(_,e){const t=.5*document.getElementById("CA_burst_hue").width,o=_.offsetX-t,r=_.offsetY-t;let s=~~(180*Math.atan2(r,o)/Math.PI);return s=~~((s+450)%360/360*e),360===e&&(s=(s+BUR_o.hue_o.shift_n)%360),s},draw__v(){for(let _ of["hue_back","hue_front"]){const e="hue";BUR_o.worker_o.post__v({task_s:"PUT_draw",stat_s:"burst",part_s:_,back_hue_n:+DOM_o.rootVar__s("--burst_hue_back"),rangeY_n:+BUR_o.hue_o.rangeY_n,shift_n:BUR_o.hue_o.shift_n,maxpos_n:BUR_o.scale_o[`${e}_n`],thresh_o:BUR_o.thresh_o})}},trace__v(_){let e,t;BUR_o.hueFreeze_b=!BUR_o.hueFreeze_b,BUR_o.hueFreeze_b?(e="hsla( 190 28% 37.75% /1)",t="cell"):(e="hsla( 190 28% 62.25% /.6)",t="crosshair"),DOM_o.rootVar__v("--burst_trace_color",e),DOM_o.rootVar__v("--burst_trace_pointer",t);let o=document.querySelector('label:has(input[name="burst_hue_range"]:checked)');if(o&&1==+o.dataset.range_n)for(let _ of["sat","lum"])BUR_o.worker_o.post__v({task_s:"PUT_draw",stat_s:"burst",part_s:_,back_hue_n:+BUR_o.trace_o.hue_e.innerHTML,shift_n:BUR_o.hue_o.shift_n,maxpos_n:BUR_o.scale_o[`${_}_n`],thresh_o:BUR_o.thresh_o})},range__v(_,e){const t=_.value;_.dataset.tip=t,e&&e(_.id,t)},eventRange__v(_){BUR_o.range__v(_.target,((e,t)=>{const o=BUR_o.hsl__s();switch(!0){case e.includes("scale"):BUR_o.scale_o[`${o}_n`]=+t,BUR_o.worker_o.post__v({task_s:"PUT_scale",stat_s:"burst",part_s:o,scale_n:BUR_o.scale_o[`${o}_n`]}),DOM_o.rootVar__v("--burst_ruler","none");break;case e.includes("thresh"):let r,s=+_.target.value;if(e.endsWith("hi")?(r="hi",s=100-s):r="lo",BUR_o.thresh_o[`${r}_n`]=s,console.log(BUR_o.thresh_o),BUR_o.thresh_o.hi_n<=BUR_o.thresh_o.lo_n)return void alert("Les seuils haut et bas se croisent")}}))},eventSpot__v(_){const e=_.target.closest("label");e&&(BUR_o.hue_o.rangeY_n=+e.dataset.range_n,BUR_o.draw__v())},eventShift__v(_){_.preventDefault();const e=_.target.closest("label");if(e){const _=e.id.split("_")[2];let t=+document.getElementById(`output_burst_${_}`).value;t<+DOM_o.rootVar__s(`--burst_${_}_back`)&&(t=(t+360)%360),DOM_o.rootVar__v(`--burst_${_}_back`,t),DOM_o.rootVar__v(`--burst_${_}_trace`,-360*BUR_o.SCALE_V_n),BUR_o.hue_o.shift_n=t,BUR_o.draw__v()}},eventHsl__v(_){const[,,e]=_.target.id.split("_"),{offsetX:t,offsetY:o}=_,r=+o;DOM_o.rootVar__v(`--burst_${e}_trace`,-(360*BUR_o.SCALE_V_n-r));const s=(~~(r/BUR_o.SCALE_V_n)+BUR_o.hue_o.shift_n)%360;document.getElementById(`output_burst_${e}`).value=s},eventTrace__v(_){const e=BUR_o.hsl__s();BUR_o.hueFreeze_b&&"hue"===e||(BUR_o.get_frequency__v(_,e),"mousemove"===_.type&&_.ctrlKey&&BUR_o.eventtRuler__v(_,e)),"click"===_.type&&"hue"===e&&BUR_o.trace__v(e)},eventtRuler__v(_,e){let[t,o]=BUR_o.coord__a(_,e);t=Math.abs(t),o=Math.abs(o);const r=2*Math.sqrt(t*t+o*o);let s=r<370?"none":"block";DOM_o.rootVar__v("--burst_ruler",s),DOM_o.rootVar__v("--burst_ruler_dim",`${r}px`)},listener__v(){BUR_o.trace_o={hue_e:document.getElementById("burst_hue_n"),hueRatio_e:document.getElementById("burst_hue_ratio_n"),sat_e:document.getElementById("burst_sat_n"),satRatio_e:document.getElementById("burst_sat_ratio_n"),lum_e:document.getElementById("burst_lum_n"),lumRatio_e:document.getElementById("burst_lum_ratio_n")};for(let _ of["hue","sat","lum"])for(let e of["click","mousemove"])document.getElementById(`CA_burst_${_}`)?.addEventListener(e,BUR_o.eventTrace__v);for(let _ of["hue"])DOM_o.listener__v(`DI_burst_${_}_range`,BUR_o.eventSpot__v),DOM_o.listener__v(`CA_burst_${_}_back`,BUR_o.eventHsl__v),DOM_o.listener__v(`CA_burst_${_}_back`,BUR_o.eventHsl__v,"mousemove"),DOM_o.listener__v(`LA_burst_${_}_trace`,BUR_o.eventShift__v);for(node_s of["full_screen","page_top","burst_ruler"])DOM_o.beforeNode__e(document.getElementById("DI_burst_layer_view"),`goto_${node_s}`);document.getElementById(`goto_${node_s}`)&&FUL_o.listener__v();for(let _ of["view_scale","thresh_hi","thresh_lo"])for(let e of["click","keydown"])DOM_o.listener__v(`IN_burst_${_}`,BUR_o.eventRange__v,e,{passive:!0})},init__v(){BUR_o.screen__v(),BUR_o.worker_o=STAT_o.worker__o("burst",["hue","sat","lum","hue_back","hue_front"],"LogScale Painter ColorBurst",BUR_o.message__v),BUR_o.draw__v();BUR_o.worker_o.post__v({task_s:"PUT_scale",stat_s:"burst",part_s:"hue",scale_n:BUR_o.scale_o.hue_n}),BUR_o.listener__v()}};BUR_o.init__v();