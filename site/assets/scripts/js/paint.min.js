
const PAI_o={status_o:null,SCALE_H_n:1,SCALE_V_n:2,hue_o:{grade_n:0,gap_n:0},sat_o:{grade_n:0,gap_n:0},lum_o:{grade_n:0,gap_n:0},layer_o:{perspective_n:0,distance_n:0,rotation_n:0},message__v:e=>{switch(e.task_s){case"PUT_status":PAI_o.status_o=e.status_o;break;case"PUT_error":console.log(`ERROR: ${e.error_s}`)}},range__v:(e,_)=>{const t=e.value;e.dataset.tip=t;const[,,n,a]=e.id.split("_");_&&_(n,a,t)},canvas__v:(e,_,t)=>{PAI_o.SCALE_H_n,PAI_o.SCALE_V_n},canvas__e:(e,_)=>{const t=document.createElement("canvas");return _&&_(t),t},layer__n:()=>Array.from(document.getElementById("DI_paint_layer_items").querySelectorAll("li")).length,addLayer__n:(e,_="",t="")=>{const n=PAI_o.layer__n();if(n>=8)return void alert("Le nombre de plans maximum est atteint ");let a;n>1&&PAI_o.displaySet__v(!0),e?(a=e,t="Plan"):a=_;let o="",r="",l="";return n&&(r=`input_${a}_${n}`,o=`<input id="${r}" data-layer_n=${n} type="checkbox">`,l=`for="${r}"`),DOM_o.appendNode__v(DOM_o.fragment__e(`<li data-layer_n=${n}>`+o+`<label ${l}>${t} ${n+1}</label></li>`),"DI_paint_layer_items"),DOM_o.beforeNode__v(PAI_o.canvas__e(a,(e=>{e.dataset.layer_n=n,e.dataset.size_n=1,e.title=`Plan ${n+1}`,document.documentElement.style.setProperty(`--paint_canvas_ratio_${n}`,1)})),"DI_paint_layer_position"),n},operateOn__a:()=>PAI_o.selected__a().slice(-2),selected__a:()=>Array.from(document.querySelectorAll('#DI_paint_layer_items > li[data-layer_n]:not([data-layer_b="0"]) > input:checked')),operable__a:()=>Array.from(document.querySelectorAll('#DI_paint_layer_items > li[data-layer_n]:not([data-layer_b="0"])')),masked__n:()=>Array.from(document.getElementById("DI_paint_layer_items").querySelectorAll('li[data-layer_b="0"]'))?.length,mask__v:e=>{e.dataset.layer_b=0,e.checked&&(e.checked=!1)},unmask__v:e=>{e.removeAttribute("data-layer_b")},displaySet__v:e=>DOM_o.rootVar__v("--paint_setop_display",e?"block":"none"),hideLayer__v:()=>{const e=PAI_o.selected__a();if(e.length)for(selected_e of(PAI_o.operable__a().length-e.length<3&&PAI_o.displaySet__v(!1),e)){const e=selected_e.dataset.layer_n;for(node_e of Array.from(document.querySelectorAll(`[data-layer_n="${e}"]`)))PAI_o.mask__v(node_e)}else{if(!PAI_o.masked__n())return void window.alert("Aucun plan n'est sélectionné.");if(!window.confirm("Aucun plan n'est sélectionné.\nVoulez-vous démasquer le premier plan masqué?"))return;let e=document.querySelector('#DI_paint_layer_items > li[data-layer_b="0"]');if(e){const _=e.dataset.layer_n;for(node_e of Array.from(document.querySelectorAll(`[data-layer_n="${_}"]`)))PAI_o.unmask__v(node_e);PAI_o.layer__n()>2&&PAI_o.displaySet__v(!0)}}},listener__v(){for(let e of["hue","sat","lum"]){for(let _ of["grade","gap"]){const t=document.getElementById(`IN_paint_${e}_${_}`);for(let e of["click","keydown"])t&&t.addEventListener(e,(e=>{PAI_o.range__v(e.target,((e,_,t)=>PAI_o[`${e}_o`][`${_}_n`]=+t))}))}const _=document.getElementById(`canvas_paint_${e}`);_&&_.addEventListener("click",(e=>{const{offsetX:_,offsetY:t}=e;PAI_o.canvas__v(e.target.id,_,t)}))}for(let e of["perspective","distance","rotate","scale"]){const _=document.getElementById(`IN_paint_layer_${e}`);for(let e of["click","keydown"])_&&_.addEventListener(e,(e=>{PAI_o.range__v(e.target,((e,_,t)=>{PAI_o[`${e}_o`][`${_}_n`]=+t,DOM_o.rootVar__v(`--paint_${_}`,+t)}))}))}const e=document.getElementById("LA_paint_layer_add");e&&e.addEventListener("click",(e=>{PAI_o.addLayer__n(document.querySelector("body").dataset.work_s)}));const _=document.getElementById("LA_paint_layer_hide");_&&_.addEventListener("click",(e=>{PAI_o.hideLayer__v()}));const t=document.getElementById("DI_paint_layer_setop");t&&t.addEventListener("click",(e=>{const _=e.target.closest("input")?.id;if(_){const e=_.slice(_.lastIndexOf("_")+1);if(e&&"none"!==e){const _=PAI_o.operateOn__a();if(_.length<2)return window.alert("Deux plans doivent être sélectionnés pour effectuer cette opération.");let t=PAI_o.layerIndex__s(_[0].dataset.layer_n),n=PAI_o.layerIndex__s(_[1].dataset.layer_n),a="union"===e?"Union":"difference"===e?"Différence":"intersection"===e?"Intersection":"Complément";const o=PAI_o.addLayer__n(null,e,`${a} [ ${+t+1} &#8728; ${+n+1} ] &#8943; Plan `);o&&PAI_o[`${e}__v`](o,_)}}}))},layerIndex__s:e=>e.slice(e.lastIndexOf("_")+1),none__v:(e,_)=>{console.log("none__v")},union__v:(e,_)=>{console.log("union__v"),console.table(_)},difference__v:(e,_)=>{console.log("difference__v")},intersection__v:(e,_)=>{console.log("intersection__v")},complement__v:(e,_)=>{console.log("complement__v")},init__v(){PAI_o.worker_o=STAT_o.worker__o("paint","LogScale Painter",PAI_o.message__v),PAI_o.addLayer__n(document.querySelector("body").dataset.work_s),PAI_o.listener__v()}};PAI_o.init__v();