
const DATE_o={dataTimeNumeric__s(e=!0,_=(new Date).toISOString(),o="fr-FR"){let t=new Intl.DateTimeFormat(o,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(_));return e&&(t=t.replaceAll("/","-").replaceAll(":","-").replaceAll(" ","_")),t}};UI_o={rangeVar__v(e,_){const o=e.value;e.dataset.tip=o,_&&DOM_o.rootVar__v(`--${_}`,o)}};const DRAG_o={init__v(e){DRAG_o.drag_e=e,DRAG_o.atX_n=0,DRAG_o.atY_n=0,DRAG_o.toX_n=0,DRAG_o.toY_n=0,DRAG_o.gapX_n=0,DRAG_o.gapY_n=0},listen__v(e,_="remove"){for(let o of e)DRAG_o.drag_e[`${_}EventListener`](`mouse${o}`,DRAG_o[`${o}__v`],!1)},enable__v(){DRAG_o.disable_b=!1,DRAG_o.listen__v(["down"],"add")},disable__v(){DRAG_o.disable_b=!0,DRAG_o.listen__v(["down"],"remove")},down__v(e){e.preventDefault(),DRAG_o.disable_b||(DRAG_o.gapX_n=e.clientX-DRAG_o.atX_n,DRAG_o.gapY_n=e.clientY-DRAG_o.atY_n,DRAG_o.listen__v(["move","up"],"add"))},move__v(e){DRAG_o.disable_b||(DRAG_o.toX_n=e.clientX-DRAG_o.gapX_n,DRAG_o.toY_n=e.clientY-DRAG_o.gapY_n,DRAG_o.atX_n=DRAG_o.toX_n,DRAG_o.atY_n=DRAG_o.toY_n,requestAnimationFrame(DRAG_o.frame__v))},up__v(e){DRAG_o.disable_b||DRAG_o.listen__v(["move","up"])},frame__v(){DRAG_o.drag_e.style.transform=`translate3d(${DRAG_o.toX_n}px, ${DRAG_o.toY_n}px, 0)`}},EXP_o={local_a:[],local_n:0,full_e:null,order__n(){const e=+DOM_o.rootVar__s("--expo_order_n")+1;return DOM_o.rootVar__v("--expo_order_n",e),e},caption__v(){console.log("caption__v")},selectable__v(){for(let e of Array.from(document.querySelectorAll("#DI_expo_masonry > figure > figcaption")))e.addEventListener("click",EXP_o.select__v)},zoomable__v(){for(let e of Array.from(document.querySelectorAll("img[data-fullsize_b]")))e.addEventListener("click",EXP_o.sizeEventFull__v)},async show__v(){let e="",_=[];await LOC_o.idb_o.walk__v(((e,o)=>{_.push({key_s:e,value_o:JSON.parse(o)})})),_.sort(((e,_)=>e.value_o.order_n-_.value_o.order_n));for(let o of _){const _=o.value_o;let t,a;_.src_s?(t=_.src_s,a=_.caption_b?_.caption_s:"<span data-ins=₉><b data-local=1>image locale</b><b>"+_.id_s+"</b></span>"):(t=`https://chercheurdart-2.netlify.app/assets/media/img/${o.key_s}.avif`,a=_.caption_s),e+=`<figure data-id="E${_.id_s}" data-display_b=${_.display_b} data-key_s="${o.key_s}"><img src="${t}" width="${_.width_s}" height="${_.height_s}" loading="lazy" data-fullsize_b=true><figcaption data-local>`+a+"</figcaption></figure>\n"}document.getElementById("DI_expo_masonry").innerHTML=e,EXP_o.selectable__v(),EXP_o.zoomable__v()},select__v(e){if(e.ctrlKey)return;const _=e.target.closest("figure");_&&_.classList.toggle("selected")},async hide__v(){for(let e of Array.from(document.querySelectorAll("figure.selected"))){e.dataset.display_b=!1;const _=e.dataset.key_s;let o=await LOC_o.idb_o.get__(_);if(o){const e=JSON.parse(o);e.display_b=!e.display_b,LOC_o.idb_o.set__v(_,JSON.stringify(e)),EXP_o.show__v()}}},async group__v(){let e,_;for(let o of Array.from(document.querySelectorAll("figure.selected"))){if(!e){e=o.parentNode,_=o;continue}const t=e.removeChild(o);e.insertBefore(t,_.nextSibling),_=t}let o=[];for(let e of Array.from(document.querySelectorAll("#DI_expo_masonry > figure"))){const _=e.dataset.key_s,t=await LOC_o.idb_o.get__(_),a=JSON.parse(t),l=EXP_o.order__n();a.order_n=l,o.push({key_s:_,value_s:JSON.stringify(a)}),LOC_o.idb_o.delete__v(_)}for(let e of o)LOC_o.idb_o.set__v(e.key_s,e.value_s)},remove__v(){for(let e of Array.from(document.querySelectorAll("figure.selected")))LOC_o.idb_o.delete__v(e.dataset.key_s),e.parentNode.removeChild(e)},async local__v(){const e=await window.showOpenFilePicker({multiple:!0,types:[{description:"Image JPEG",accept:{"image/jpeg":[".jpg",".jpeg"]}}]});let _=[],o=EXP_o.local_n++,t="";for(let a of e){const e=a.name.slice(0,a.name.lastIndexOf(".")),l=e.replaceAll("--","~"),n=`<figure data-id="E_${l}" data-display_b=true data-key_s="${e}"><img id="img_local_${o}" loading="lazy"><a href="#"></a><figcaption>${l}</figcaption></figure>\n`;_.push({id_s:e,local_n:o,file_o:a,caption_s:n}),t+=n}const a=document.getElementById("DI_expo_masonry");let l=a.innerHTML;a.innerHTML=l+t;for(let e of _){const{id_s:_,local_n:o,caption_s:t,file_o:a}=e,l=document.querySelector(`#img_local_${o}`);if(l){const e=new FileReader;e.addEventListener("load",(()=>{l.src=e.result,l.addEventListener("load",(()=>{LOC_o.idb_o.set__v(DATE_o.dataTimeNumeric__s(),JSON.stringify({id_s:_,order_n:EXP_o.order__n(),display_b:!0,caption_s:t,width_s:l.naturalWidth,height_s:l.naturalHeight,src_s:l.src}))}))}),!1);const o=await a.getFile();await e.readAsDataURL(o),l.parentNode.addEventListener("click",EXP_o.select__v),l.addEventListener("click",EXP_o.sizeEventFull__v)}}},burst__v(){const e=Array.from(document.querySelectorAll("figure.selected"));if(!e.length||e.length>1)return void window.alert("Pour effectuer cette opération, sélectionnez une seule image locale.");const _=e[0];if(!_.querySelector("img").src.startsWith("data:image/jpeg;base64"))return void window.alert("Veuillez sélectionnez une image locale.");const o=_.dataset.key_s;location.href=`local--burst.html?k=${o}`},async dialogEvent__v(e){const _=e.target.id;switch(!0){case _.endsWith("cancel"):console.log("cancel");break;case _.endsWith("accept"):const e=Array.from(document.querySelectorAll("figure.selected"));if(!e.length)return void window.alert("Veuillez sélectionnez une image locale à décrire.");const o=e[0];if(!o.querySelector("img").src.startsWith("data:image/jpeg;base64"))return void window.alert("Veuillez sélectionnez une image locale.");const t={};for(let e of document.querySelectorAll("input[id^=IN_expo_dialog_][type=text]")){const _="IN_expo_dialog_".length;t[`${e.id.substring(_)}`]=e.value}let a=`<span data-ins=₉><b>${t.artist_s}</b>`;const l=t.link_s;a+=l?`<b><a href="${l}">${t.subject_s}</a></b>`:`<b>${t.subject_s}</b>`,a+=`<b>${t.year_n}</b><b><i>${t.w_height_n}</i><i>${t.w_width_n}</i></b><b>${t.location_s}</b><b>${t.place_s} ∙ ${t.country_s}</b>`,a+="</span>";const n=o.dataset.key_s;let i=await LOC_o.idb_o.get__(n);if(i){const e=JSON.parse(i);e.caption_s=a,e.caption_b=!0,LOC_o.idb_o.set__v(n,JSON.stringify(e)),EXP_o.show__v()}break;case _.endsWith("reset"):for(let e of document.querySelectorAll("input[id^=IN_expo_dialog_][type=text]"))e.value=""}},rangeEvent__v(e){UI_o.rangeVar__v(e.target,"expo_wrap_n")},sizeEventFull__v(e){EXP_o.full_e||(EXP_o.full_e=e.target,"false"!==EXP_o.full_e.parentNode.dataset.display_b&&(EXP_o.full_e.classList.toggle("fullsize"),DRAG_o.init__v(EXP_o.full_e),DRAG_o.enable__v(),DOM_o.rootVar__v("--expo_zoom_out_s","flex")))},sizeEventTiny__v(){EXP_o.full_e.classList.toggle("fullsize"),DRAG_o.disable__v(),DOM_o.rootVar__v("--expo_zoom_out_s","none"),EXP_o.full_e=null,EXP_o.show__v()},listen__v(){DOM_o.rootVar__v("--expo_wrap_n","5"),document.getElementById("LA_expo_zoom_out").addEventListener("click",EXP_o.sizeEventTiny__v);for(let e of["hide","remove","group","local","caption","burst"]){const _=document.getElementById(`LA_expo_${e}`);_&&_.addEventListener("click",EXP_o[`${e}__v`])}for(let e of["accept","cancel","reset"]){const _=document.getElementById(`IN_expo_dialog_${e}`);_&&_.addEventListener("change",EXP_o.dialogEvent__v)}for(let e of["wrap_n"])for(let _ of["click","keydown"])DOM_o.listener__v(`IN_expo_${e}`,EXP_o.rangeEvent__v,_)},init__v(){EXP_o.listen__v(),EXP_o.show__v()}};EXP_o.init__v();