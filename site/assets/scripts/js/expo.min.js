
const DATE_o={dataTimeNumeric__s(e=!0,t=(new Date).toISOString(),o="fr-FR"){let _=new Intl.DateTimeFormat(o,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(t));return e&&(_=_.replaceAll("/","-").replaceAll(":","-").replaceAll(" ","_")),_}};UI_o={rangeVar__v(e,t){const o=e.value;e.dataset.tip=o,t&&DOM_o.rootVar__v(`--${t}`,o)}};const EXP_o={local_a:[],local_n:0,order__n(){const e=+DOM_o.rootVar__s("--expo_order_n")+1;return DOM_o.rootVar__v("--expo_order_n",e),e},async show__v(){let e="",t=[];await LOC_o.idb_o.walk__v(((e,o)=>{t.push({key_s:e,value_o:JSON.parse(o)})})),t.sort(((e,t)=>e.value_o.order_n-t.value_o.order_n));for(let o of t){const t=o.value_o;let _,r;t.src_s?(_=t.src_s,r="<span data-ins=₉><b data-local=1>ajouter</b><b>"+t.id_s+"</b></span>"):(_=`https://chercheurdart-2.netlify.app/assets/media/img/${o.key_s}.avif`,r=t.caption_s),e+=`<figure data-id="E${t.id_s}" data-display_b=${t.display_b} data-key_s="${o.key_s}"><img src="${_}" width="${t.width_s}" height="${t.height_s}" loading="lazy"><figcaption data-local>`+r+"</figcaption></figure>\n"}document.getElementById("DI_expo_masonry").innerHTML=e,EXP_o.selectable__v()},select__v(e){if(e.ctrlKey)return;const t=e.target.closest("figure");t&&t.classList.toggle("selected")},async hide__v(){for(let e of Array.from(document.querySelectorAll("figure.selected"))){e.dataset.display_b=!1;const t=e.dataset.key_s;let o=await LOC_o.idb_o.get__(t);if(o){const e=JSON.parse(o);e.display_b=!e.display_b,LOC_o.idb_o.set__v(t,JSON.stringify(e)),EXP_o.show__v()}}},async group__v(){let e,t;for(let o of Array.from(document.querySelectorAll("figure.selected"))){if(!e){e=o.parentNode,t=o;continue}const _=e.removeChild(o);e.insertBefore(_,t.nextSibling),t=_}let o=[];for(let e of Array.from(document.querySelectorAll("#DI_expo_masonry > figure"))){const t=e.dataset.key_s,_=await LOC_o.idb_o.get__(t),r=JSON.parse(_),a=EXP_o.order__n();r.order_n=a,o.push({key_s:t,value_s:JSON.stringify(r)}),LOC_o.idb_o.delete__v(t)}for(let e of o)LOC_o.idb_o.set__v(e.key_s,e.value_s)},remove__v(){for(let e of Array.from(document.querySelectorAll("figure.selected")))LOC_o.idb_o.delete__v(e.dataset.key_s),e.parentNode.removeChild(e)},caption__v(){console.log("caption__v")},burst__v(){const e=Array.from(document.querySelectorAll("figure.selected"));if(!e.length||e.length>1)return void window.alert("Pour effectuer cette opération, sélectionnez une seule image locale.");const t=e[0];if(!t.querySelector("img").src.startsWith("data:image/jpeg;base64"))return void window.alert("Veuillez sélectionnez une image locale.");const o=t.dataset.key_s;location.href=`local--burst.html?k=${o}`},async local__v(){const e=await window.showOpenFilePicker({multiple:!0,types:[{description:"Image JPEG",accept:{"image/jpeg":[".jpg",".jpeg"]}}]});let t=[],o=EXP_o.local_n++,_="";for(let r of e){const e=r.name.slice(0,r.name.lastIndexOf(".")),a=e.replaceAll("--","~"),l=`<figure data-id="E_${a}" data-display_b=true data-key_s="${e}"><img id="img_local_${o}" loading="lazy"><a href="#"></a><figcaption>${a}</figcaption></figure>\n`;t.push({id_s:e,local_n:o,file_o:r,caption_s:l}),_+=l}const r=document.getElementById("DI_expo_masonry");let a=r.innerHTML;r.innerHTML=a+_;for(let e of t){const{id_s:t,local_n:o,caption_s:_,file_o:r}=e,a=document.querySelector(`#img_local_${o}`);if(a){const e=new FileReader;e.addEventListener("load",(()=>{a.src=e.result,a.addEventListener("load",(()=>{LOC_o.idb_o.set__v(DATE_o.dataTimeNumeric__s(),JSON.stringify({id_s:t,order_n:EXP_o.order__n(),display_b:!0,caption_s:_,width_s:a.naturalWidth,height_s:a.naturalHeight,src_s:a.src}))}))}),!1);const o=await r.getFile();await e.readAsDataURL(o),a.parentNode.addEventListener("click",EXP_o.select__v)}}EXP_o.selectable__v()},rangeEvent__v(e){UI_o.rangeVar__v(e.target,"expo_wrap_n")},selectable__v(){for(let e of Array.from(document.querySelectorAll("#DI_expo_masonry > figure")))e.addEventListener("click",EXP_o.select__v)},listen__v(){for(let e of["hide","remove","group","local","caption","burst"]){const t=document.getElementById(`LA_expo_${e}`);t&&t.addEventListener("click",EXP_o[`${e}__v`])}for(let e of["wrap_n"])for(let t of["click","keydown"])DOM_o.listener__v(`IN_expo_${e}`,EXP_o.rangeEvent__v,t);DOM_o.rootVar__v("--expo_wrap_n","2")},init__v(){EXP_o.listen__v(),EXP_o.show__v()}};EXP_o.init__v();